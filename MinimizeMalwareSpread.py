class Solution:
    def minMalwareSpread(self, graph: List[List[int]], initial: List[int]) -> int:
        initial = set(initial)
        visited = set()

        counts = {}

        def dfs(graph, node, vis, initial):
            if node in vis:
                return 0,0
            vis.add(node)
            initial_count, node_count = node in initial, 1

            for v in range(len(graph)):
                if graph[node][v] == 1:
                    ic,nc = dfs(graph, v, vis, initial)
                    initial_count += ic
                    node_count += nc
            
            return initial_count, node_count

        for node in initial:
            if node not in visited:
                initial_count, node_count = dfs(graph, node, visited, initial)
                if initial_count == 1:
                    counts[node] = node_count
        if len(counts) > 0:
            _, neg_n = max((c,-n) for n,c in counts.items())
            return -neg_n
        else:
            return min(initial)